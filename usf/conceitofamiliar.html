<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Conceito Familiar ‚Äì Estrutural Sist√™mico (Minuchin)</title>
<style>
:root{
  --bg:#f5f5f7;
  --card:#fff;
  --text:#1f2937;
  --muted:#6b7280;
  --border:#e5e7eb;
  --ok:#065f46;
  --ok-bg:#d1fae5;
  --warn:#92400e;
  --warn-bg:#ffedd5;
  --bad:#7f1d1d;
  --bad-bg:#fee2e2;
  --focus:#4f46e5;
  --shadow-soft:0 18px 45px rgba(15,23,42,.12);
}

*{box-sizing:border-box}

/* FUNDO GERAL ESTILO "SITE" */
body{
  margin:0;
  background:radial-gradient(circle at top,#e5f0ff 0,#f5f5f7 45%,#f9fafb 100%);
  color:var(--text);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
  font-size:0.9rem;
}

a{
  color:inherit;
  text-decoration:none;
}

/* HEADER / NAVBAR */
header.site-header{
  position:sticky;
  top:0;
  z-index:10;
  backdrop-filter:blur(16px);
  background:linear-gradient(to bottom,rgba(245,245,247,.95),rgba(245,245,247,.86));
  border-bottom:1px solid rgba(209,213,219,.7);
}

.nav-inner{
  max-width:900px;
  margin:0 auto;
  padding:12px 20px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:24px;
}

.brand{
  display:flex;
  align-items:center;
  gap:10px;
}

.brand-mark{
  width:28px;
  height:28px;
  border-radius:999px;
  border:1px solid #111827;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:.85rem;
  font-weight:600;
}

.brand-text{
  display:flex;
  flex-direction:column;
  line-height:1.2;
}

.brand-title{
  font-size:.95rem;
  font-weight:600;
}

.brand-subtitle{
  font-size:.7rem;
  text-transform:uppercase;
  letter-spacing:.16em;
  color:var(--muted);
}

.nav-links{
  display:flex;
  align-items:center;
  gap:16px;
  font-size:.82rem;
  color:var(--muted);
  flex-wrap:wrap;
}

.nav-back{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:5px 10px;
  border-radius:999px;
  border:1px solid #d1d5db;
  font-size:.78rem;
  background:#ffffff;
  cursor:pointer;
  transition:background .15s,transform .12s,color .15s;
}

.nav-back span:first-child{
  font-size:.9rem;
  transform:translateY(1px);
}

.nav-back:hover{
  background:#111827;
  color:#f9fafb;
  transform:translateY(-1px);
}

.nav-pill{
  padding:5px 10px;
  border-radius:999px;
  border:1px solid #d1d5db;
  font-size:.72rem;
  text-transform:uppercase;
  letter-spacing:.14em;
  background:#ffffff;
}

/* PAGE WRAPPER */
.page{
  max-width:900px;
  margin:0 auto;
  padding:28px 20px 60px;
}

/* HERO */
.hero-conceito{
  margin-bottom:18px;
}

.hero-badge{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:4px 11px;
  border-radius:999px;
  border:1px solid rgba(148,163,184,.5);
  font-size:.75rem;
  letter-spacing:.16em;
  text-transform:uppercase;
  color:var(--muted);
  background:rgba(255,255,255,.85);
  backdrop-filter:blur(18px);
}

.hero-badge-dot{
  width:6px;
  height:6px;
  border-radius:999px;
  background:#22c55e;
  box-shadow:0 0 0 4px rgba(34,197,94,.2);
}

.hero-title{
  margin:14px 0 4px;
  font-size:clamp(1.7rem,2.3vw,2rem);
  line-height:1.1;
  letter-spacing:.02em;
}

.hero-title span{
  display:block;
  font-weight:300;
  color:var(--muted);
}

.hero-text{
  margin:0;
  margin-top:6px;
  font-size:.92rem;
  color:var(--muted);
  max-width:650px;
}

/* CARD WRAPPER (onde entra o conte√∫do original) */
.card-wrapper{
  background:var(--card);
  border-radius:20px;
  border:1px solid var(--border);
  box-shadow:var(--shadow-soft);
  padding:16px 16px 18px;
}

/* CONTE√öDO ORIGINAL */
.container{
  max-width:650px;
  margin:0 auto;
  padding:0;
}
h1{
  margin:0 0 4px;
  font-size:1.4rem;
}
.sub{
  color:var(--muted);
  margin:0 0 12px;
  font-size:0.85rem;
}
.card{
  background:#fff;
  border:1px solid var(--border);
  border-radius:10px;
  padding:10px;
  box-shadow:0 1px 2px rgba(0,0,0,.04);
}
.grid{
  display:grid;
  gap:10px;
  grid-template-columns:1fr;
}
@media(min-width:900px){
  .grid{grid-template-columns:1fr 1fr}
}
label{
  display:block;
  margin-bottom:3px;
  font-weight:600;
  font-size:0.85rem;
}
select,input{
  width:100%;
  padding:6px 8px;
  border:1px solid var(--border);
  border-radius:8px;
  font-size:0.85rem;
}
select:focus,input:focus{
  border-color:var(--focus);
  box-shadow:0 0 0 3px rgba(79,70,229,.15);
  outline:none;
}
.section-title{
  font-weight:800;
  margin-top:4px;
  font-size:0.85rem;
}
.small{
  font-size:.78rem;
  color:var(--muted);
}
.result-panel{
  border:1px solid var(--border);
  border-radius:10px;
  padding:10px;
  background:#fff;
  margin-top:10px;
  font-size:0.85rem;
}
.kpis{
  display:grid;
  grid-template-columns:1fr;
  gap:8px;
}
@media(min-width:900px){
  .kpis{grid-template-columns:1fr 1fr}
}
.kpi{
  border:1px solid var(--border);
  border-radius:8px;
  padding:8px;
  display:flex;
  align-items:baseline;
  justify-content:space-between;
  gap:10px;
}
.value{
  font-size:1rem;
  font-weight:800;
}
.pill{
  display:inline-block;
  padding:4px 8px;
  border-radius:999px;
  font-size:.75rem;
  font-weight:700;
}
.pill-ok{background:var(--ok-bg);color:var(--ok)}
.pill-warn{background:var(--warn-bg);color:var(--warn)}
.pill-bad{background:var(--bad-bg);color:var(--bad)}
.badge{
  display:inline-block;
  padding:4px 8px;
  border-radius:8px;
  border:1px solid var(--border);
  font-size:.8rem;
  color:var(--muted);
}
.err{
  background:var(--bad-bg);
  color:var(--bad);
  border:1px solid #fecaca;
}

/* BLOCO LEITURA R√ÅPIDA */
.tips{
  margin-top:6px;
}

/* BOT√ïES */
.controls{
  display:flex;
  gap:8px;
  margin-top:10px;
  flex-wrap:wrap;
  justify-content:flex-end;
}
.btn{
  background:var(--focus);
  color:#fff;
  border:none;
  padding:6px 10px;
  border-radius:999px;
  cursor:pointer;
  font-size:0.8rem;
  font-weight:600;
  box-shadow:0 4px 10px rgba(15,23,42,.2);
  display:flex;
  align-items:center;
  gap:4px;
  transition:background .2s, transform .08s, box-shadow .2s;
}
.btn:hover{
  background:#3730a3;
  transform:translateY(-1px);
  box-shadow:0 8px 18px rgba(15,23,42,.25);
}

/* FOOTER */
footer.site-footer{
  border-top:1px solid rgba(209,213,219,.7);
  margin-top:32px;
  padding:14px 20px 20px;
  font-size:.8rem;
  color:var(--muted);
  display:flex;
  justify-content:space-between;
  gap:8px;
  flex-wrap:wrap;
  max-width:900px;
  margin-left:auto;
  margin-right:auto;
}
footer.site-footer strong{
  font-weight:500;
  color:#111827;
}

/* RESPONSIVO */
@media(max-width:640px){
  .nav-inner{
    flex-direction:column;
    align-items:flex-start;
  }
  .page{
    padding:22px 16px 40px;
  }
}

/* IMPRESS√ÉO: A5 retrato, compacto para 1 p√°gina */
@media print{
  @page{
    size:A5 portrait;
    margin:0.5cm;
  }
  header.site-header,
  footer.site-footer,
  .hero-conceito{
    display:none !important;
  }
  body{
    background:#fff;
    font-size:0.8rem;
  }
  .page{
    max-width:none;
    padding:6px 6px;
    margin:0;
  }
  .card-wrapper{
    border:none;
    box-shadow:none;
    padding:0;
  }
  .container{
    max-width:none;
    padding:0;
  }
  h1{
    font-size:1.1rem;
    margin-bottom:2px;
  }
  .sub{
    display:none !important;
  }
  .card,
  .result-panel{
    box-shadow:none;
    border-color:#bbb;
    padding:6px;
    margin-top:6px;
  }
  .grid{
    gap:4px;
  }
  label{
    margin-bottom:2px;
  }
  .section-title{
    margin-top:3px;
    font-size:0.7rem;
  }
  select,input{
    padding:4px 6px;
    font-size:0.7rem;
  }
  .small{
    font-size:0.6rem;
  }
  .value{
    font-size:0.9rem;
  }
  .pill{
    font-size:0.6rem;
    padding:3px 6px;
  }
  .kpis{
    grid-template-columns:1fr;
    gap:4px;
  }
  .kpi{
    padding:6px;
    gap:6px;
  }
  .tips{
    display:none !important;
  }
  .controls{
    display:none !important;
  }
}
</style>
</head>
<body>

  <!-- HEADER GLOBAL -->
  <header class="site-header">
    <div class="nav-inner">
      <div class="brand">
        <div class="brand-mark">M</div>
        <div class="brand-text">
          <div class="brand-title">Medicina Integrada</div>
          <div class="brand-subtitle">USF ‚Ä¢ Conceito Familiar</div>
        </div>
      </div>
      <nav class="nav-links">
        <a href="index.html" class="nav-back">
          <span>‚¨Ö</span>
          <span>Voltar √† USF</span>
        </a>
        <span class="nav-pill">Estrutural sist√™mico ¬∑ Minuchin</span>
      </nav>
    </div>
  </header>

  <main class="page">
    <!-- HERO -->
    <section class="hero-conceito">
      <div class="hero-badge">
        <span class="hero-badge-dot"></span>
        AVALIA√á√ÉO FAMILIAR ‚Ä¢ ESTRUTURA
      </div>
      <h1 class="hero-title">
        Conceito Familiar ‚Äì Estrutural Sist√™mico
        <span>Leitura de fronteiras, hierarquia e coes√£o para orientar interven√ß√µes.</span>
      </h1>
      <p class="hero-text">
        Instrumento baseado no modelo de Minuchin, explorando organiza√ß√£o dos subsistemas familiares
        (conjugal, parental, fraternal), padr√µes de comunica√ß√£o, regras, flexibilidade e estressores
        no contexto da Aten√ß√£o Prim√°ria.
      </p>
    </section>

    <!-- CARD PRINCIPAL -->
    <section class="card-wrapper">
      <div class="container">
        <h1>Conceito Familiar ‚Äì Estrutural Sist√™mico</h1>
        <p class="sub">
          Modelo de <b>Minuchin</b>: leitura de <b>fronteiras</b>, <b>hierarquia</b>, <b>coes√£o</b>, <b>comunica√ß√£o</b>, 
          <b>regras</b>, <b>flexibilidade</b>, <b>alian√ßas/coaliz√µes</b>, <b>triangula√ß√£o</b> e <b>estressores</b> ‚Äî para orientar interven√ß√µes na APS.
        </p>

        <section class="card">
          <div class="grid">
            <!-- FRONTEIRAS -->
            <div>
              <label class="section-title">Fronteiras entre subsistemas</label>
              <select id="fronteiras">
                <option value="">Selecione</option>
                <option value="difusas">Difusas (enredamento, invas√£o)</option>
                <option value="claras">Claras (perme√°veis e protetoras)</option>
                <option value="rigidas">R√≠gidas (distanciamento, isolamento)</option>
              </select>
              <div class="small">Entre subsistemas conjugal, parental e fraternal.</div>
            </div>

            <!-- HIERARQUIA -->
            <div>
              <label class="section-title">Hierarquia parental</label>
              <select id="hierarquia">
                <option value="">Selecione</option>
                <option value="adequada">Adequada (lideran√ßa parental est√°vel)</option>
                <option value="invertida">Invertida (filho/pai exerce poder sobre o parental)</option>
                <option value="ausente">Aus√™ncia de lideran√ßa (caos/indefini√ß√£o)</option>
              </select>
            </div>

            <!-- COES√ÉO (3 itens 0‚Äì3) -->
            <div>
              <label class="section-title">Coes√£o ‚Äì proximidade/apoio</label>
              <select id="coesaoProx">
                <option value="">0‚Äì3: proximidade</option>
                <option value="0">0 ‚Äì Muito distante</option>
                <option value="1">1 ‚Äì Distante</option>
                <option value="2">2 ‚Äì Pr√≥ximo</option>
                <option value="3">3 ‚Äì Muito pr√≥ximo</option>
              </select>
            </div>
            <div>
              <label class="section-title">Coes√£o ‚Äì tempo juntos</label>
              <select id="coesaoTempo">
                <option value="">0‚Äì3: tempo</option>
                <option value="0">0 ‚Äì Quase nunca</option>
                <option value="1">1 ‚Äì Pouco</option>
                <option value="2">2 ‚Äì Frequente</option>
                <option value="3">3 ‚Äì Quase sempre</option>
              </select>
            </div>
            <div>
              <label class="section-title">Coes√£o ‚Äì lealdade/pertencimento</label>
              <select id="coesaoLeal">
                <option value="">0‚Äì3: lealdade</option>
                <option value="0">0 ‚Äì Baix√≠ssima</option>
                <option value="1">1 ‚Äì Baixa</option>
                <option value="2">2 ‚Äì Alta</option>
                <option value="3">3 ‚Äì Muito alta</option>
              </select>
            </div>

            <!-- COMUNICA√á√ÉO -->
            <div>
              <label class="section-title">Comunica√ß√£o</label>
              <select id="comunicacao">
                <option value="">Selecione</option>
                <option value="clara">Clara/Assertiva</option>
                <option value="indireta">Indireta/Amb√≠gua</option>
                <option value="hostil">Hostil/Violenta</option>
              </select>
            </div>

            <!-- REGRAS -->
            <div>
              <label class="section-title">Regras familiares</label>
              <select id="regras">
                <option value="">Selecione</option>
                <option value="explicitas">Expl√≠citas/Compartilhadas</option>
                <option value="implicitas">Impl√≠citas/Veladas</option>
                <option value="contraditorias">Contradit√≥rias/Incoerentes</option>
              </select>
            </div>

            <!-- FLEXIBILIDADE -->
            <div>
              <label class="section-title">Flexibilidade/Adapta√ß√£o</label>
              <select id="flex">
                <option value="">Selecione</option>
                <option value="rigida">R√≠gida (pouca adapta√ß√£o)</option>
                <option value="equilibrada">Equilibrada</option>
                <option value="caotica">Ca√≥tica (mudan√ßas imprevis√≠veis)</option>
              </select>
            </div>

            <!-- ALIAN√áAS/COALIZ√ïES -->
            <div>
              <label class="section-title">Alian√ßas e coaliz√µes</label>
              <select id="aliancas">
                <option value="">Selecione</option>
                <option value="funcionais">Alian√ßas funcionais (suporte sem exclus√µes)</option>
                <option value="coalizoes">Coaliz√µes disfuncionais (A+B contra C)</option>
                <option value="nenhuma">Nenhuma relevante</option>
              </select>
            </div>

            <!-- TRIANGULA√á√ÉO -->
            <div>
              <label class="section-title">Triangula√ß√£o</label>
              <select id="triang">
                <option value="">Selecione</option>
                <option value="nao">N√£o</option>
                <option value="sim">Sim (terceiro √© puxado para reduzir tens√£o)</option>
              </select>
            </div>

            <!-- ESTRESSORES -->
            <div>
              <label class="section-title">Estressores atuais</label>
              <select id="estressores">
                <option value="">Selecione</option>
                <option value="nenhum">Nenhum/Recurso adequado</option>
                <option value="moderado">Moderado (situa√ß√µes manej√°veis)</option>
                <option value="severo">Severo (doen√ßa, perdas, crises m√∫ltiplas)</option>
              </select>
            </div>

            <!-- OBS -->
            <div style="grid-column:1/-1">
              <label class="section-title">Observa√ß√µes</label>
              <input id="obs" placeholder="Ex.: av√≥s cuidadores, filho adulto retornando ao lar, presen√ßa de viol√™ncia pr√©via, etc.">
            </div>
          </div>
        </section>

        <div id="painel" class="result-panel">
          Preencha os campos para gerar o <b>perfil estrutural</b>.
        </div>

        <!-- Painel de Conceito Familiar -->
        <div id="conceito" class="result-panel">
          <div class="small"><b>1.3. Conceito Familiar ‚Äì S√≠ntese descritiva</b></div>
          <p class="small">Preencha os campos acima para gerar uma descri√ß√£o textual da organiza√ß√£o familiar segundo o modelo estrutural sist√™mico.</p>
        </div>

        <p class="small tips">
          <b>Leitura r√°pida:</b> fronteiras <i>difusas</i> ‚Üí risco de <u>enredamento</u>; fronteiras <i>r√≠gidas</i> ‚Üí risco de <u>desligamento</u>.
          Hierarquia parental <i>invertida/ausente</i> ‚Üí risco de <u>caos</u> e <u>triangula√ß√µes</u>.
          Coes√£o muito baixa ‚Üí <u>desligamento</u>; coes√£o muito alta + fronteiras difusas ‚Üí <u>enredamento</u>.
        </p>

        <!-- BOT√ïES -->
        <div class="controls">
          <button class="btn" id="btnVoltar">‚¨ÖÔ∏è Voltar</button>
          <button class="btn" id="btnPrint">üñ®Ô∏è Imprimir</button>
          <button class="btn" id="btnNext">‚û°Ô∏è Pr√≥ximo</button>
        </div>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <span>Desenvolvido por <strong>Gabriel Ortega Antonio</strong></span>
    <span>M√≥dulo USF ‚Ä¢ Conceito Familiar (Minuchin)</span>
  </footer>

<script>
(function(){
  const get = id => document.getElementById(id);
  const painel = get('painel');
  const conceito = get('conceito');
  let avaliacaoPronta = false;

  function toNum(id){
    const v = Number(get(id).value);
    return Number.isFinite(v) ? v : null;
  }

  function coesaoMedia(){
    const a = toNum('coesaoProx');
    const b = toNum('coesaoTempo');
    const c = toNum('coesaoLeal');
    if(a===null || b===null || c===null) return null;
    return (a+b+c)/3;
  }

  function coesaoPerfil(){
    const c = coesaoMedia();
    if(c === null) return null;
    if(c < 1) return 'desligada';
    if(c <= 2) return 'equilibrada';
    return 'enredada';
  }

  function textoConceito(perfil, eixoCoesao, fronteiras, hierarquia, comunicacao, regras, flex, estress, obs){
    let intro;
    if(perfil.includes('EQUILIBRADA')){
      intro = 'Trata-se de uma fam√≠lia organizada e funcional, com estrutura geral favorecedora do cuidado e da conviv√™ncia.';
    } else if(perfil.includes('ENREDADA')){
      intro = 'Trata-se de uma fam√≠lia com v√≠nculos intensos e forte proximidade, por√©m com tend√™ncia ao enredamento entre seus membros.';
    } else if(perfil.includes('DESLIGADA')){
      intro = 'Trata-se de uma fam√≠lia mais distanciada, com menor integra√ß√£o entre os membros e risco de desligamento afetivo.';
    } else if(perfil.includes('CA√ìTICA')){
      intro = 'Trata-se de uma fam√≠lia que se encontra em configura√ß√£o mais ca√≥tica/desorganizada, com instabilidade na distribui√ß√£o de fun√ß√µes e no manejo das rela√ß√µes.';
    } else {
      intro = 'Trata-se de uma fam√≠lia com arranjo estrutural intermedi√°rio, combinando aspectos organizados e pontos de vulnerabilidade.';
    }

    const partes = [];

    if(fronteiras === 'claras' && eixoCoesao === 'equilibrada'){
      partes.push('As fronteiras entre os subsistemas s√£o claras e protetoras, permitindo coes√£o adequada sem perda de individualidade.');
    } else if(fronteiras === 'difusas'){
      partes.push('As fronteiras tendem a ser mais difusas, com maior envolvimento m√∫tuo e menor diferencia√ß√£o entre pap√©is e espa√ßos individuais.');
    } else if(fronteiras === 'rigidas'){
      partes.push('As fronteiras apresentam-se mais r√≠gidas, com tend√™ncia ao distanciamento e menor circula√ß√£o afetiva entre os subsistemas.');
    }

    if(eixoCoesao === 'desligada'){
      partes.push('A coes√£o √© baixa, com pouca proximidade emocional e apoio compartilhado no cotidiano.');
    } else if(eixoCoesao === 'enredada'){
      partes.push('A coes√£o √© muito alta, com grande intensidade de contato e envolvimento, o que pode dificultar movimentos de autonomia.');
    } else if(eixoCoesao === 'equilibrada'){
      partes.push('A coes√£o √© equilibrada, favorecendo sensa√ß√£o de pertencimento e, ao mesmo tempo, preservando espa√ßo para a autonomia.');
    }

    if(hierarquia === 'adequada'){
      partes.push('A hierarquia parental se mant√©m adequada, com lideran√ßa relativamente est√°vel na condu√ß√£o das decis√µes familiares.');
    } else if(hierarquia === 'invertida'){
      partes.push('Observa-se hierarquia parcialmente invertida, com membros em posi√ß√£o filial assumindo fun√ß√µes ou poder t√≠pico do subsistema parental.');
    } else if(hierarquia === 'ausente'){
      partes.push('H√° fragilidade importante na hierarquia, com aus√™ncia de lideran√ßa clara e maior risco de caos nas decis√µes cotidianas.');
    }

    if(comunicacao === 'clara'){
      partes.push('A comunica√ß√£o tende a ser clara e assertiva, abrindo espa√ßo para express√£o de opini√µes e negocia√ß√£o de acordos.');
    } else if(comunicacao === 'indireta'){
      partes.push('A comunica√ß√£o √© mais indireta ou amb√≠gua, o que pode gerar mal-entendidos e dificultar o ajuste entre expectativas.');
    } else if(comunicacao === 'hostil'){
      partes.push('A comunica√ß√£o apresenta elementos hostis ou agressivos, aumentando a tens√£o nas intera√ß√µes.');
    }

    if(regras === 'explicitas'){
      partes.push('As regras familiares s√£o, em geral, expl√≠citas e compartilhadas, o que facilita a organiza√ß√£o do conv√≠vio.');
    } else if(regras === 'implicitas'){
      partes.push('As regras tendem a ser impl√≠citas ou pouco verbalizadas, exigindo leitura ‚Äúnas entrelinhas‚Äù por parte dos membros.');
    } else if(regras === 'contraditorias'){
      partes.push('Existem regras contradit√≥rias ou pouco coerentes, o que pode gerar confus√£o e inseguran√ßa quanto √†s expectativas familiares.');
    }

    if(flex === 'equilibrada'){
      partes.push('A flexibilidade aparece de forma equilibrada, permitindo ajustes frente √†s mudan√ßas sem perda de refer√™ncias b√°sicas.');
    } else if(flex === 'rigida'){
      partes.push('A fam√≠lia demonstra rigidez na adapta√ß√£o, com dificuldade em rever padr√µes e acordos diante de novas demandas.');
    } else if(flex === 'caotica'){
      partes.push('A flexibilidade assume um padr√£o mais ca√≥tico, com mudan√ßas bruscas e pouco previs√≠veis nas regras e rotinas.');
    }

    if(estress === 'nenhum'){
      partes.push('Os estressores atuais parecem estar em n√≠vel manej√°vel, com recursos internos suficientes para o enfrentamento.');
    } else if(estress === 'moderado'){
      partes.push('H√° presen√ßa de estressores moderados, demandando aten√ß√£o para que n√£o ultrapassem a capacidade adaptativa da fam√≠lia.');
    } else if(estress === 'severo'){
      partes.push('Estressores severos est√£o presentes, exigindo suporte ampliado e maior monitoramento da sobrecarga familiar.');
    }

    let resumoObs = '';
    if(obs){
      resumoObs = `<p class="small"><b>Resumo da fam√≠lia/caso:</b> ${obs}</p>`;
    }

    return `
      <div class="small"><b>1.3. Conceito Familiar ‚Äì S√≠ntese descritiva</b></div>
      ${resumoObs}
      <p class="small">${intro}</p>
      <p class="small">${partes.join(' ')}</p>
    `;
  }

  function classificarEstrutura(){
    const fronteiras = get('fronteiras').value;
    const hierarquia = get('hierarquia').value;
    const comunicacao = get('comunicacao').value;
    const regras = get('regras').value;
    const flex = get('flex').value;
    const aliancas = get('aliancas').value;
    const triang = get('triang').value;
    const estress = get('estressores').value;
    const obs = get('obs').value.trim();
    const eixoCoesao = coesaoPerfil();

    const faltando = [fronteiras,hierarquia,comunicacao,regras,flex,aliancas,triang,estress,eixoCoesao]
      .some(v=>v==='' || v===null);
    if(faltando){
      avaliacaoPronta = false;
      painel.textContent = 'Preencha todos os campos (inclua os 3 itens de coes√£o).';
      conceito.innerHTML = `
        <div class="small"><b>1.3. Conceito Familiar ‚Äì S√≠ntese descritiva</b></div>
        <p class="small">Preencha os campos acima para gerar uma descri√ß√£o textual da organiza√ß√£o familiar segundo o modelo estrutural sist√™mico.</p>
      `;
      return;
    }

    const flags = [];
    const contextos = [];

    if(fronteiras==='difusas') flags.push('Fronteiras difusas (risco de enredamento)');
    if(fronteiras==='rigidas') flags.push('Fronteiras r√≠gidas (risco de desligamento)');
    if(fronteiras==='claras') contextos.push('Fronteiras claras');

    if(hierarquia==='invertida') flags.push('Hierarquia invertida');
    else if(hierarquia==='ausente') flags.push('Aus√™ncia de lideran√ßa parental');
    else contextos.push('Hierarquia parental adequada');

    if(comunicacao==='indireta') flags.push('Comunica√ß√£o indireta/amb√≠gua');
    if(comunicacao==='hostil') flags.push('Comunica√ß√£o hostil/violenta');
    if(comunicacao==='clara') contextos.push('Comunica√ß√£o clara');

    if(regras==='implicitas') flags.push('Regras impl√≠citas/veladas');
    if(regras==='contraditorias') flags.push('Regras contradit√≥rias/incoerentes');
    if(regras==='explicitas') contextos.push('Regras expl√≠citas');

    if(flex==='rigida') flags.push('Baixa flexibilidade');
    if(flex==='caotica') flags.push('Flexibilidade ca√≥tica');
    if(flex==='equilibrada') contextos.push('Flexibilidade equilibrada');

    if(aliancas==='coalizoes') flags.push('Coaliz√µes disfuncionais');
    if(triang==='sim') flags.push('Triangula√ß√£o presente');
    if(aliancas==='funcionais') contextos.push('Alian√ßas funcionais');

    if(estress==='moderado') flags.push('Estressores moderados');
    if(estress==='severo') flags.push('Estressores severos');
    if(estress==='nenhum') contextos.push('Estressores controlados');

    let perfil = 'Estrutura equilibrada';
    let pill = 'pill-ok';

    const eixo = eixoCoesao;

    if(eixo==='enredada' && fronteiras==='difusas'){
      perfil = 'Estrutura ENREDADA';
      pill = 'pill-warn';
    }
    if(eixo==='desligada' && fronteiras==='rigidas'){
      perfil = 'Estrutura DESLIGADA';
      pill = 'pill-warn';
    }
    if((hierarquia==='ausente' || hierarquia==='invertida') &&
       (flex==='caotica' || comunicacao==='hostil' || aliancas==='coalizoes' || triang==='sim')){
      perfil = 'Estrutura CA√ìTICA / DESORGANIZADA';
      pill = 'pill-bad';
    }
    if(fronteiras==='claras' && hierarquia==='adequada' && flex==='equilibrada' &&
       comunicacao==='clara' && eixo==='equilibrada'){
      perfil = 'Estrutura EQUILIBRADA';
      pill = 'pill-ok';
    }

    let foco = 'Revisar rotinas, clarificar regras e fortalecer comunica√ß√£o.';
    if(perfil.includes('ENREDADA')) foco = 'Trabalhar fronteiras (diferencia√ß√£o), incentivar autonomia individual e regras expl√≠citas.';
    else if(perfil.includes('DESLIGADA')) foco = 'Aumentar coes√£o/pertencimento, criar espa√ßos de conviv√™ncia e comunica√ß√£o afetiva.';
    else if(perfil.includes('CA√ìTICA')) foco = 'Restaurar hierarquia parental, acordar regras claras, reduzir triangula√ß√µes e coaliz√µes disfuncionais.';
    else if(perfil.includes('EQUILIBRADA')) foco = 'Manter fatores protetores; monitorar estressores e transi√ß√µes do ciclo de vida.';

    // salvar no localStorage
    localStorage.setItem('perfilEstrutural', perfil);
    localStorage.setItem('eixoCoesao', eixo);
    localStorage.setItem('fronteiras', fronteiras);
    localStorage.setItem('hierarquia', hierarquia);
    localStorage.setItem('comunicacao', comunicacao);
    localStorage.setItem('regras', regras);
    localStorage.setItem('flex', flex);
    localStorage.setItem('aliancas', aliancas);
    localStorage.setItem('triang', triang);
    localStorage.setItem('estressoresNivel', estress);
    localStorage.setItem('conceitoObs', obs);

    avaliacaoPronta = true;

    painel.className='result-panel';
    painel.innerHTML = `
      <div class="kpis">
        <div class="kpi">
          <div>
            <div class="small">Perfil estrutural (s√≠ntese)</div>
            <div class="value">${perfil}</div>
            <div class="small">Coes√£o: <b>${eixo}</b> ¬∑ Fronteiras: <b>${fronteiras}</b> ¬∑ Hierarquia: <b>${hierarquia}</b></div>
          </div>
          <span class="pill ${pill}">${perfil}</span>
        </div>

        <div class="kpi">
          <div>
            <div class="small">Comunica√ß√£o ¬∑ Regras ¬∑ Flexibilidade</div>
            <div class="value">${comunicacao} ¬∑ ${regras} ¬∑ ${flex}</div>
            <div class="small">Alian√ßas/Coaliz√µes: <b>${aliancas}</b> ¬∑ Triangula√ß√£o: <b>${triang}</b></div>
          </div>
          <span class="pill ${(comunicacao==='clara' && regras==='explicitas' && flex==='equilibrada') ? 'pill-ok' : 'pill-warn'}">
            ${(comunicacao==='clara' && regras==='explicitas' && flex==='equilibrada') ? 'Organiza√ß√£o saud√°vel' : 'Pontos a ajustar'}
          </span>
        </div>
      </div>

      <div class="small" style="margin-top:6px"><b>Estressores:</b> ${estress}${estress!=='nenhum'?' ‚Äî considerar ampliar rede/recursos.':''}</div>
      ${flags.length?`<div class="small" style="margin-top:8px;color:#7f1d1d"><b>Sinais de alerta:</b><br>‚Ä¢ ${flags.join('<br>‚Ä¢ ')}</div>`:''}
      <div class="small" style="margin-top:8px"><b>Foco de interven√ß√£o:</b> ${foco}</div>
      ${obs?`<div class="small" style="margin-top:8px">Obs.: ${obs}</div>`:''}
    `;

    conceito.innerHTML = textoConceito(perfil, eixo, fronteiras, hierarquia, comunicacao, regras, flex, estress, obs);
  }

  document.addEventListener('change', e=>{
    const ids=['fronteiras','hierarquia','comunicacao','regras','flex','aliancas','triang','estressores','coesaoProx','coesaoTempo','coesaoLeal'];
    if(ids.includes(e.target.id)) classificarEstrutura();
  });
  document.addEventListener('input', e=>{
    if(['obs'].includes(e.target.id)) classificarEstrutura();
  });

  // Bot√µes Voltar / Imprimir / Pr√≥ximo
  document.getElementById('btnVoltar').addEventListener('click', ()=> history.back());
  document.getElementById('btnPrint').addEventListener('click', ()=> window.print());
  document.getElementById('btnNext').addEventListener('click', ()=>{
    if(!avaliacaoPronta){
      alert('Preencha todos os campos (incluindo os 3 itens de coes√£o) antes de continuar.');
      return;
    }
    window.location.href = 'determinantesemsaude.html';
  });
})();
</script>
</body>
</html>
