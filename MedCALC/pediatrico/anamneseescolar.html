<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Anamnese – Criança em Idade Escolar (6–10 anos) | UBS</title>
<style>
  :root{
    --bg:#f5f5f7;
    --bg-section:#ffffff;
    --card:#fff;
    --text:#0f172a;
    --muted:#6b7280;
    --border:#e5e7eb;
    --focus:#4f46e5;
    --ok:#16a34a;
    --warn:#ea580c;
    --danger:#dc2626;
    --shadow-soft:0 18px 45px rgba(15,23,42,.12);
  }

  *{box-sizing:border-box}

  body{
    margin:0;
    background:radial-gradient(circle at top,#e5f0ff 0,#f5f5f7 45%,#f9fafb 100%);
    color:var(--text);
    font-family:system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
    font-size:.9rem;
  }

  a{
    color:inherit;
    text-decoration:none;
  }

  /* HEADER / NAVBAR */
  header.site-header{
    position:sticky;
    top:0;
    z-index:10;
    backdrop-filter:blur(16px);
    background:linear-gradient(to bottom,rgba(245,245,247,.95),rgba(245,245,247,.86));
    border-bottom:1px solid rgba(209,213,219,.7);
  }

  .nav-inner{
    max-width:1100px;
    margin:0 auto;
    padding:12px 20px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:24px;
  }

  .brand{
    display:flex;
    align-items:center;
    gap:10px;
  }

  .brand-mark{
    width:28px;
    height:28px;
    border-radius:999px;
    border:1px solid #111827;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:.85rem;
    font-weight:600;
  }

  .brand-text{
    display:flex;
    flex-direction:column;
    line-height:1.2;
  }

  .brand-title{
    font-size:.95rem;
    font-weight:600;
  }

  .brand-subtitle{
    font-size:.7rem;
    text-transform:uppercase;
    letter-spacing:.16em;
    color:var(--muted);
  }

  .nav-links{
    display:flex;
    align-items:center;
    gap:16px;
    font-size:.82rem;
    color:var(--muted);
    flex-wrap:wrap;
  }

  .nav-back{
    display:inline-flex;
    align-items:center;
    gap:6px;
    padding:5px 10px;
    border-radius:999px;
    border:1px solid #d1d5db;
    font-size:.78rem;
    background:#ffffff;
    cursor:pointer;
    transition:background .15s,transform .12s,color .15s;
  }

  .nav-back span:first-child{
    font-size:.9rem;
    transform:translateY(1px);
  }

  .nav-back:hover{
    background:#111827;
    color:#f9fafb;
    transform:translateY(-1px);
  }

  .nav-pill{
    padding:5px 10px;
    border-radius:999px;
    border:1px solid #d1d5db;
    font-size:.72rem;
    text-transform:uppercase;
    letter-spacing:.14em;
    background:#ffffff;
  }

  /* PAGE WRAPPER */
  .page{
    max-width:1160px;
    margin:0 auto;
    padding:26px 16px 40px;
  }

  /* HERO / TÍTULO */
  .hero-escolar{
    margin-bottom:18px;
  }

  .hero-badge{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding:4px 11px;
    border-radius:999px;
    border:1px solid rgba(148,163,184,.5);
    font-size:.75rem;
    letter-spacing:.16em;
    text-transform:uppercase;
    color:var(--muted);
    background:rgba(255,255,255,.9);
    backdrop-filter:blur(18px);
  }

  .hero-badge-dot{
    width:6px;
    height:6px;
    border-radius:999px;
    background:#22c55e;
    box-shadow:0 0 0 4px rgba(34,197,94,.2);
  }

  .hero-title{
    margin:14px 0 4px;
    font-size:clamp(1.6rem,2.2vw,2.0rem);
    line-height:1.1;
    letter-spacing:.02em;
  }

  .hero-title span{
    display:block;
    font-weight:300;
    color:var(--muted);
  }

  .hero-text{
    margin:0;
    margin-top:6px;
    font-size:.9rem;
    color:var(--muted);
    max-width:720px;
  }

  /* CARDS / FORMULÁRIO */
  section.card{
    background:var(--card);
    border:1px solid var(--border);
    border-radius:14px;
    padding:16px 16px;
    box-shadow:0 1px 2px rgba(0,0,0,.04);
  }

  .sub{color:var(--muted);margin:0 0 18px}

  .grid{display:grid;gap:12px;grid-template-columns:1fr}
  @media(min-width:980px){.grid{grid-template-columns:repeat(12,1fr)}}
  .col-2{grid-column:span 2}
  .col-3{grid-column:span 3}
  .col-4{grid-column:span 4}
  .col-5{grid-column:span 5}
  .col-6{grid-column:span 6}
  .col-7{grid-column:span 7}
  .col-8{grid-column:span 8}
  .col-12{grid-column:1/-1}

  label{
    display:block;
    margin-bottom:6px;
    font-weight:650;
    font-size:.9rem;
  }

  input,select,textarea{
    width:100%;
    padding:9px 10px;
    border:1px solid var(--border);
    border-radius:10px;
    font-size:.9rem;
    background:#fff;
  }

  textarea{min-height:110px;resize:vertical}

  input:focus,select:focus,textarea:focus{
    border-color:var(--focus);
    box-shadow:0 0 0 3px rgba(79,70,229,.15);
    outline:none;
  }

  .hstack{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .badge{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:999px;background:#eef2ff;color:#4338ca;font-size:.8rem;font-weight:700}
  .hint{color:var(--muted);font-size:.85rem}
  .section-title{font-weight:800}
  .note{font-size:.9rem;color:#374151}
  .soft{color:#6b7280}

  .kpi{display:flex;gap:10px;flex-wrap:wrap}
  .pill{padding:4px 10px;border-radius:999px;border:1px solid var(--border);font-size:.85rem}
  .pill.ok{background:#ecfdf5;color:#065f46;border-color:#a7f3d0}
  .pill.warn{background:#fff7ed;color:#9a3412;border-color:#fed7aa}
  .pill.danger{background:#fef2f2;color:#991b1b;border-color:#fecaca}

  .hr{height:1px;background:var(--border);margin:14px 0}

  .result{
    white-space:pre-wrap;
    border:1px dashed var(--border);
    padding:12px;
    border-radius:12px;
    background:#fcfcff;
    font-size:.9rem;
  }

  .split{display:grid;grid-template-columns:1fr;gap:16px}
  @media(min-width:980px){.split{grid-template-columns:1.2fr .8fr}}

  @media (max-width:640px){
    .nav-inner{
      flex-direction:column;
      align-items:flex-start;
    }
    .page{
      padding:20px 14px 32px;
    }
  }

  /* IMPRESSÃO */
  @media print{
    @page{size:A4;margin:12mm}
    :root{--bg:#fff}
    body{background:#fff;font-size:.9rem}
    header.site-header,
    .hero-escolar{display:none!important}
    .page{max-width:none;padding:0}
    section.card{box-shadow:none;border:0;padding:0}
    .hr{margin:8px 0}
    .sub{margin-bottom:8px}
  }
</style>
</head>
<body>

<header class="site-header">
  <div class="nav-inner">
    <div class="brand">
      <div class="brand-mark">P</div>
      <div class="brand-text">
        <div class="brand-title">Medicina Integrada</div>
        <div class="brand-subtitle">Pediatria • Escolar 6–10a</div>
      </div>
    </div>
    <nav class="nav-links">
      <a href="index.html" class="nav-back">
        <span>⬅</span>
        <span>Voltar ao módulo Pediatria</span>
      </a>
      <span class="nav-pill">Escolar 6–10a</span>
    </nav>
  </div>
</header>

<main class="page">
  <!-- HERO -->
  <section class="hero-escolar">
    <div class="hero-badge">
      <span class="hero-badge-dot"></span>
      ANAMNESE PEDIÁTRICA • IDADE ESCOLAR
    </div>
    <h1 class="hero-title">
      Anamnese Pediátrica – Criança em Idade Escolar (6 a 10 anos)
      <span>Roteiro para consultas em UBS, avaliação de queixas escolares e promoção de saúde.</span>
    </h1>
    <p class="hero-text">
      Sequência sugerida: Identificação → QP → HMA → ISDA → Antecedentes → Familiares →
      Social/Ambiente → Hábitos → Desenvolvimento → Escola → Exposição/Segurança → Observações → Síntese.
    </p>
  </section>

  <!-- 1. Identificação -->
  <section class="card" style="margin-bottom:12px">
    <div class="hstack" style="margin-bottom:8px"><div class="badge">1. Identificação</div><span class="hint">Dados da criança e do(s) acompanhante(s).</span></div>
    <div class="grid">
      <div class="col-6"><label>Nome completo</label><input id="id_nome"></div>
      <div class="col-3"><label>Data de nascimento</label><input id="id_dob" type="date"></div>
      <div class="col-3"><label>Idade (anos)</label><input id="id_idade_a" type="number" min="6" max="10" placeholder="auto" title="Calculado pela data de nascimento"></div>
      <div class="col-3"><label>Idade (meses)</label><input id="id_idade_m" type="number" min="72" max="131" placeholder="auto" title="Total de meses"></div>
      <div class="col-3"><label>Sexo</label><input id="id_sexo" placeholder="F, M, intersexo"></div>
      <div class="col-6"><label>Acompanhantes e vínculo</label><input id="id_acomp" placeholder="pai, mãe, responsável"></div>
      <div class="col-3"><label>Confiabilidade do informante</label>
        <select id="id_conf">
          <option value="">—</option>
          <option>Boa</option>
          <option>Regular</option>
          <option>Duvidosa</option>
        </select>
      </div>
      <div class="col-6"><label>Naturalidade e procedência</label><input id="id_natproc" placeholder="Cidade/UF; bairro"></div>
    </div>
  </section>

  <div class="split">
    <div>
      <!-- 2. QP -->
      <section class="card" style="margin-bottom:14px">
        <div class="hstack" style="margin-bottom:8px"><div class="badge">2. QP</div><span class="section-title">Queixa principal</span></div>
        <input id="qp" placeholder="Ex.: 'Cefaleia frequente', 'dificuldade na escola', 'ansioso', 'não quer comer'">
        <div class="hint" style="margin-top:6px">Registrar duração e circunstâncias em que ocorre.</div>
      </section>

      <!-- 3. HMA -->
      <section class="card" style="margin-bottom:14px">
        <div class="hstack" style="margin-bottom:8px"><div class="badge">3. HMA</div><span class="section-title">História da Moléstia Atual</span></div>
        <textarea id="hma" placeholder="Início/tempo de evolução/intensidade; fatores desencadeantes e melhora/piora; sintomas (febre, dor, fadiga, sono, apetite, humor); impacto nas atividades e no rendimento escolar; falas da criança (o que te incomoda? como é a dor?); condutas dos pais e resposta."></textarea>
      </section>

      <!-- 4. ISDA -->
      <section class="card" style="margin-bottom:14px">
        <div class="hstack" style="margin-bottom:8px"><div class="badge">4. ISDA</div><span class="section-title">Interrogatório sobre os diversos aparelhos</span></div>
        <div class="grid">
          <div class="col-12"><label>Geral</label><input id="isda_geral" placeholder="febre, cansaço, perda de peso, apetite"></div>
          <div class="col-6"><label>Respiratório</label><input id="isda_resp" placeholder="tosse, chiado, dispneia, ronco"></div>
          <div class="col-6"><label>Cardiovascular</label><input id="isda_cardio" placeholder="palpitações, dor torácica, intolerância ao esforço"></div>
          <div class="col-6"><label>Digestivo</label><input id="isda_dig" placeholder="dor abdominal, constipação, diarreia, náusea/vômitos"></div>
          <div class="col-6"><label>Urinário</label><input id="isda_urin" placeholder="polaquiúria, enurese noturna, disúria"></div>
          <div class="col-6"><label>Neurológico</label><input id="isda_neuro" placeholder="cefaleias, tonturas, atenção, convulsões"></div>
          <div class="col-6"><label>Pele</label><input id="isda_pele" placeholder="prurido, lesões, alergias"></div>
          <div class="col-12"><label>Musculoesquelético</label><input id="isda_musc" placeholder="dor em membros, postura, quedas"></div>
        </div>
      </section>

      <!-- 5. Antecedentes pessoais -->
      <section class="card" style="margin-bottom:14px">
        <div class="hstack" style="margin-bottom:8px"><div class="badge">5. Antecedentes</div><span class="section-title">Pessoais</span></div>
        <div class="grid">
          <div class="col-12"><span class="note"><strong>a) Gestacionais e neonatais</strong></span></div>
          <div class="col-8"><label>Gestação/parto/intercorrências</label><input id="ant_gest_parto" placeholder="resumo perinatal"></div>
          <div class="col-4"><label>Aleitamento/IA</label><input id="ant_lm" placeholder="AME e introdução alimentar"></div>
          <div class="col-12"><label>Crescimento/desenvolvimento iniciais</label><input id="ant_dnpm_ini" placeholder="primeiros anos"></div>

          <div class="col-12"><div class="hr"></div><span class="note"><strong>b) Patológicos</strong></span></div>
          <div class="col-6"><label>Doenças prévias</label><input id="ant_doencas" placeholder="asma, alergias, ITU, internações, cirurgias"></div>
          <div class="col-3"><label>Medicamentos contínuos</label><input id="ant_meds"></div>
          <div class="col-3"><label>Condições crônicas</label><input id="ant_cron" placeholder="anemia, asma, epilepsia, obesidade"></div>

          <div class="col-12"><div class="hr"></div><span class="note"><strong>c) Vacinação</strong></span></div>
          <div class="col-12"><label>Cartão vacinal (PNI)</label><input id="ant_vac" placeholder="reforços/HPV quando aplicável; atrasos/reações"></div>
        </div>
      </section>

      <!-- 6. Familiares -->
      <section class="card" style="margin-bottom:14px">
        <div class="hstack" style="margin-bottom:8px"><div class="badge">6. Familiares</div><span class="section-title">Antecedentes familiares</span></div>
        <div class="grid">
          <div class="col-6"><label>Doenças hereditárias/crônicas</label><input id="fam_cron" placeholder="HAS, DM, dislipidemia, asma, epilepsia, psiquiátricas"></div>
          <div class="col-6"><label>Obesidade/distúrbios alimentares</label><input id="fam_obes"></div>
          <div class="col-6"><label>Consanguinidade dos pais</label><input id="fam_consan"></div>
        </div>
      </section>

      <!-- 7. Social/Ambiental -->
      <section class="card" style="margin-bottom:14px">
        <div class="hstack" style="margin-bottom:8px"><div class="badge">7. Social/Ambiente</div><span class="section-title">Contexto e ambiente</span></div>
        <div class="grid">
          <div class="col-6"><label>Composição familiar/dinâmica</label><input id="soc_comp"></div>
          <div class="col-6"><label>Escolaridade/ocupação dos responsáveis</label><input id="soc_resp"></div>
          <div class="col-6"><label>Condições da casa</label><input id="soc_casa" placeholder="ventilação, saneamento, água potável, animais"></div>
          <div class="col-6"><label>Vulnerabilidade/violência/negligência</label><input id="soc_vuln"></div>
          <div class="col-12"><label>Ambiente escolar</label><input id="soc_escola" placeholder="apoio docente, relação com colegas"></div>
        </div>
      </section>

      <!-- 8. Hábitos e rotina -->
      <section class="card" style="margin-bottom:14px">
        <div class="hstack" style="margin-bottom:8px"><div class="badge">8. Hábitos</div><span class="section-title">Rotina diária</span></div>
        <div class="grid">
          <div class="col-6"><label>Alimentação</label><input id="hab_ali" placeholder="qualidade, frequência, ultraprocessados"></div>
          <div class="col-6"><label>Sono</label><input id="hab_sono" placeholder="horas, horários, ronco/pesadelos"></div>
          <div class="col-6"><label>Higiene</label><input id="hab_hig" placeholder="escovação/dentista; corporal/mãos"></div>
          <div class="col-6"><label>Atividade física</label><input id="hab_ativ" placeholder="esportes, ar livre, tempo de tela (min/dia)"></div>
          <div class="col-6"><label>Responsabilidades/rotinas</label><input id="hab_resp" placeholder="tarefas domésticas, autonomia"></div>
        </div>
      </section>

      <!-- 9. Desenvolvimento global -->
      <section class="card" style="margin-bottom:14px">
        <div class="hstack" style="margin-bottom:8px"><div class="badge">9. Desenvolvimento</div><span class="section-title">Global</span></div>
        <div class="grid">
          <div class="col-6"><label>Motor grosso</label><input id="dev_grosso" placeholder="coordenação, equilíbrio, esportes"></div>
          <div class="col-6"><label>Motor fino</label><input id="dev_fino" placeholder="escrita, desenho, recorte, utensílios"></div>
          <div class="col-6"><label>Cognitivo/escolar</label><input id="dev_cog" placeholder="leitura, escrita, concentração, raciocínio"></div>
          <div class="col-6"><label>Linguagem</label><input id="dev_ling" placeholder="vocabulário, compreensão, expressão"></div>
          <div class="col-6"><label>Socioemocional</label><input id="dev_soc" placeholder="colegas, professores, empatia, autoestima"></div>
          <div class="col-6"><label>Autonomia</label><input id="dev_auto" placeholder="vestir-se, organizar materiais, cumprir rotinas"></div>
          <div class="col-12"><label>Observações de rastreio</label><input id="dev_obs" placeholder="atentar a TDAH, dislexia, ansiedade, bullying"></div>
        </div>
      </section>

      <!-- 10. Escola e socialização -->
      <section class="card" style="margin-bottom:14px">
        <div class="hstack" style="margin-bottom:8px"><div class="badge">10. Escola</div><span class="section-title">Escola e socialização</span></div>
        <div class="grid">
          <div class="col-4"><label>Escola e série</label><input id="esc_nome" placeholder="nome da escola e série"></div>
          <div class="col-4"><label>Frequência/pontualidade</label><input id="esc_freq"></div>
          <div class="col-4"><label>Desempenho</label><input id="esc_desemp" placeholder="leitura, escrita, cálculo"></div>
          <div class="col-6"><label>Relações</label><input id="esc_rel" placeholder="colegas/professores"></div>
          <div class="col-6"><label>Queixas comportamentais</label><input id="esc_queixas" placeholder="atenção, agitação, timidez, isolamento"></div>
          <div class="col-12"><label>Bullying (vítima/autor)</label><input id="esc_bully"></div>
        </div>
      </section>

      <!-- 11. Exposição e segurança -->
      <section class="card" style="margin-bottom:14px">
        <div class="hstack" style="margin-bottom:8px"><div class="badge">11. Exposição/Segurança</div><span class="section-title">Proteção e riscos</span></div>
        <div class="grid">
          <div class="col-4"><label>Exposição solar/protetor</label><input id="seg_solar"></div>
          <div class="col-4"><label>Transporte</label><input id="seg_transp" placeholder="cinto/cadeirinha"></div>
          <div class="col-4"><label>Riscos domésticos</label><input id="seg_dom" placeholder="produtos tóxicos, fogão, janelas"></div>
          <div class="col-6"><label>EPIs</label><input id="seg_epi" placeholder="capacete, joelheiras, etc."></div>
          <div class="col-6"><label>Internet/Conteúdo</label><input id="seg_web" placeholder="acesso a conteúdo inapropriado, supervisão"></div>
        </div>
      </section>

      <!-- 12. Observações dos cuidadores -->
      <section class="card" style="margin-bottom:14px">
        <div class="hstack" style="margin-bottom:8px"><div class="badge">12. Observações</div><span class="section-title">Dos cuidadores</span></div>
        <textarea id="obs_cuid" placeholder="Preocupações (comportamento, aprendizagem, alimentação); percepção de crescimento/maturidade; reações da família às dificuldades escolares."></textarea>
      </section>

      <!-- 13. Síntese avaliativa -->
      <section class="card">
        <div class="hstack" style="margin-bottom:8px"><div class="badge">13. Síntese</div><span class="section-title">Avaliativa e plano</span></div>
        <div class="grid">
          <div class="col-3"><label>Peso (kg)</label><input id="aux_peso" type="number" step="0.1" placeholder="ex.: 24.5"></div>
          <div class="col-3"><label>Estatura (cm)</label><input id="aux_alt" type="number" step="0.1" placeholder="ex.: 123.4"></div>
          <div class="col-3"><label>IMC (kg/m²)</label><input id="aux_imc" placeholder="auto" readonly></div>
          <div class="col-3"><label>Status nutricional</label><input id="aux_nutri" placeholder="—" readonly title="Apenas indicativo (sem percentis)"></div>

          <div class="col-12"><label>Crescimento/estado nutricional</label><textarea id="sint_cresc"></textarea></div>
          <div class="col-12"><label>Desempenho escolar e desenvolvimento</label><textarea id="sint_dev"></textarea></div>
          <div class="col-12"><label>Fatores de risco (físicos/psicológicos/sociais)</label><textarea id="sint_risco"></textarea></div>
          <div class="col-12"><label>Condutas e orientações</label><textarea id="sint_cond" placeholder="hábitos saudáveis, prevenção de acidentes, higiene, sono, rotina escolar"></textarea></div>
        </div>
      </section>
    </div>

    <!-- Painel lateral -->
    <div>
      <section class="card">
        <div class="hstack" style="justify-content:space-between;align-items:center">
          <strong>Síntese da Anamnese (gerada automaticamente)</strong>
          <span class="hint">Imprimir: Ctrl+P / ⌘P</span>
        </div>
        <div class="hr"></div>
        <div class="kpi" id="kpi_bar">
          <div class="pill" id="kpi_idade">Idade: —</div>
          <div class="pill" id="kpi_meses">Meses: —</div>
          <div class="pill" id="kpi_escola">Escola: —</div>
          <div class="pill" id="kpi_telas">Tela: —</div>
          <div class="pill" id="kpi_vac">Vacinas: —</div>
          <div class="pill" id="kpi_seg">Segurança: —</div>
          <div class="pill" id="kpi_imc">IMC: —</div>
        </div>
        <div class="hr"></div>
        <div class="result" id="preview">Preencha os campos para gerar a nota.</div>
      </section>

      <section class="card" style="margin-top:14px">
        <div class="hstack" style="margin-bottom:8px"><div class="badge">Checklist</div><span class="section-title">Sinais de Alerta (6–10 anos)</span></div>
        <ul class="soft" style="margin:0 0 0 18px; padding:0 0 0 4px; line-height:1.6">
          <li>Perda de peso não explicada, febre persistente, fadiga extrema</li>
          <li>Dispneia/chiado importante, dor torácica em esforço</li>
          <li>Dor abdominal persistente, vômitos biliosos, desidratação</li>
          <li>Cefaleias intensas ou com sinais neurológicos; convulsões</li>
          <li>Rebaixamento do rendimento escolar ou regressão comportamental abrupta</li>
          <li>Evidências de violência, bullying grave, ideação autoagressiva</li>
        </ul>
      </section>
    </div>
  </div>

  <p class="hint" style="margin-top:12px">
    Dica: correlacione QP/HMA com impacto funcional (escola, sono, atividades) e registre intervenções já tentadas.
    Reavalie hábitos, telas, atividade física e higiene do sono.
  </p>
</main>

<script>
(function(){
  const $=id=>document.getElementById(id);

  const fields=[
    'id_nome','id_dob','id_idade_a','id_idade_m','id_sexo','id_acomp','id_conf','id_natproc',
    'qp','hma',
    'isda_geral','isda_resp','isda_cardio','isda_dig','isda_urin','isda_neuro','isda_pele','isda_musc',
    'ant_gest_parto','ant_lm','ant_dnpm_ini','ant_doencas','ant_meds','ant_cron','ant_vac',
    'fam_cron','fam_obes','fam_consan',
    'soc_comp','soc_resp','soc_casa','soc_vuln','soc_escola',
    'hab_ali','hab_sono','hab_hig','hab_ativ','hab_resp',
    'dev_grosso','dev_fino','dev_cog','dev_ling','dev_soc','dev_auto','dev_obs',
    'esc_nome','esc_freq','esc_desemp','esc_rel','esc_queixas','esc_bully',
    'seg_solar','seg_transp','seg_dom','seg_epi','seg_web',
    'obs_cuid',
    'aux_peso','aux_alt','aux_imc','aux_nutri',
    'sint_cresc','sint_dev','sint_risco','sint_cond'
  ];

  fields.forEach(id=>$(id)?.addEventListener('input',update));

  // Idade automática
  $('id_dob')?.addEventListener('change',()=>{
    const val = $('id_dob').value;
    if(!val){ update(); return;}
    const dob = new Date(val+'T00:00');
    const now = new Date();
    let months=(now.getFullYear()-dob.getFullYear())*12 + (now.getMonth()-dob.getMonth());
    if(now.getDate()<dob.getDate()) months-=1;
    months=Math.max(0,months);
    $('id_idade_m').value = months;
    $('id_idade_a').value = Math.floor(months/12);
    update();
  });

  // IMC automático (indicativo, sem percentis)
  function calcIMC(){
    const peso = parseFloat(($('aux_peso').value||'').replace(',','.'));
    const alt = parseFloat(($('aux_alt').value||'').replace(',','.'));
    if(!isFinite(peso) || !isFinite(alt) || alt<=0) return null;
    const m = alt/100.0;
    return peso/(m*m);
  }

  function badgeIMCvalue(imc){
    if(imc==null) return '—';
    return imc.toFixed(1);
  }

  function badgeNutri(imc){
    if(imc==null) return '';
    // Nota: classificação pediátrica requer percentis por idade/sexo.
    // Aqui, rótulos apenas indicativos por faixas de adulto para referência rápida.
    if(imc<16) return 'Muito baixo (indicativo)';
    if(imc<18.5) return 'Abaixo (indicativo)';
    if(imc<25) return 'Eutrófico (indicativo)';
    if(imc<30) return 'Sobrepeso (indicativo)';
    return 'Obesidade (indicativo)';
  }

  function lineIf(label,val){const v=(val||'').toString().trim();return v?`${label}: ${v}`:''}
  function join(lines,sep='\n'){return lines.filter(Boolean).join(sep)||'—'}

  function badges(){
    const idadeA = ($('id_idade_a').value||'').trim();
    const idadeM = ($('id_idade_m').value||'').trim();
    $('kpi_idade').textContent = `Idade: ${idadeA? idadeA+"a":"—"}`;
    $('kpi_meses').textContent = `Meses: ${idadeM||'—'}`;

    const escola = ($('esc_nome').value||'').trim();
    $('kpi_escola').textContent = `Escola: ${escola? 'sim':''}` || 'Escola: —';

    // tenta extrair tempo de tela do campo de atividade + escola (se descrito)
    const telasMatch = (($('hab_ativ').value||'') + ' ' + ($('soc_escola').value||'')).match(/(\d+)\s*(min|mins|minutos|h|horas)/i);
    const telasTxt = telasMatch ? telasMatch[0] : '';
    $('kpi_telas').textContent = `Tela: ${telasTxt||'—'}`;

    const vac = ($('ant_vac').value||'').trim();
    $('kpi_vac').textContent = `Vacinas: ${vac? 'verificado':''}` || 'Vacinas: —';

    const seg = [($('seg_transp').value||''),($('seg_dom').value||''),($('seg_web').value||'')].some(v=>v.trim()) ? 'ok' : '—';
    $('kpi_seg').textContent = `Segurança: ${seg}`;

    const imc = calcIMC();
    $('aux_imc').value = imc!=null? imc.toFixed(1): '';
    $('aux_nutri').value = badgeNutri(imc);
    $('kpi_imc').textContent = `IMC: ${badgeIMCvalue(imc)}`;
  }

  function update(){
    badges();

    const blocoId = join([
      lineIf('Nome', $('id_nome').value),
      lineIf('Data de nascimento', $('id_dob').value),
      lineIf('Idade (anos)', $('id_idade_a').value),
      lineIf('Idade (meses)', $('id_idade_m').value),
      lineIf('Sexo', $('id_sexo').value),
      lineIf('Acompanhantes/vínculo', $('id_acomp').value),
      lineIf('Confiabilidade', $('id_conf').value),
      lineIf('Naturalidade/Procedência', $('id_natproc').value)
    ], ' · ');

    const blocoQP = $('qp').value || '—';
    const blocoHMA = $('hma').value || '—';

    const blocoISDA = join([
      lineIf('Geral', $('isda_geral').value),
      lineIf('Respiratório', $('isda_resp').value),
      lineIf('Cardiovascular', $('isda_cardio').value),
      lineIf('Digestivo', $('isda_dig').value),
      lineIf('Urinário', $('isda_urin').value),
      lineIf('Neurológico', $('isda_neuro').value),
      lineIf('Pele', $('isda_pele').value),
      lineIf('Musculoesquelético', $('isda_musc').value)
    ]);

    const blocoAnt = join([
      'a) Gestacionais e neonatais',
      join([
        lineIf('Gestação/parto/intercorrências', $('ant_gest_parto').value),
        lineIf('Aleitamento/IA', $('ant_lm').value),
        lineIf('Crescimento/desenvolvimento iniciais', $('ant_dnpm_ini').value)
      ]),
      '',
      'b) Patológicos',
      join([
        lineIf('Doenças prévias', $('ant_doencas').value),
        lineIf('Medicamentos contínuos', $('ant_meds').value),
        lineIf('Condições crônicas', $('ant_cron').value)
      ]),
      '',
      'c) Vacinação',
      lineIf('Cartão vacinal (PNI)', $('ant_vac').value)
    ]);

    const blocoFam = join([
      lineIf('Doenças familiares', $('fam_cron').value),
      lineIf('Obesidade/distúrbios alimentares', $('fam_obes').value),
      lineIf('Consanguinidade', $('fam_consan').value)
    ]);

    const blocoSoc = join([
      lineIf('Composição/dinâmica familiar', $('soc_comp').value),
      lineIf('Escolaridade/ocupação responsáveis', $('soc_resp').value),
      lineIf('Condições da casa', $('soc_casa').value),
      lineIf('Vulnerabilidade/violência/negligência', $('soc_vuln').value),
      lineIf('Ambiente escolar', $('soc_escola').value)
    ]);

    const blocoHab = join([
      lineIf('Alimentação', $('hab_ali').value),
      lineIf('Sono', $('hab_sono').value),
      lineIf('Higiene', $('hab_hig').value),
      lineIf('Atividade física', $('hab_ativ').value),
      lineIf('Responsabilidades/rotinas', $('hab_resp').value)
    ]);

    const blocoDev = join([
      lineIf('Motor grosso', $('dev_grosso').value),
      lineIf('Motor fino', $('dev_fino').value),
      lineIf('Cognitivo/escolar', $('dev_cog').value),
      lineIf('Linguagem', $('dev_ling').value),
      lineIf('Socioemocional', $('dev_soc').value),
      lineIf('Autonomia', $('dev_auto').value),
      lineIf('Observações de rastreio', $('dev_obs').value)
    ]);

    const blocoEscola = join([
      lineIf('Escola/série', $('esc_nome').value),
      lineIf('Frequência/pontualidade', $('esc_freq').value),
      lineIf('Desempenho', $('esc_desemp').value),
      lineIf('Relações', $('esc_rel').value),
      lineIf('Queixas comportamentais', $('esc_queixas').value),
      lineIf('Bullying', $('esc_bully').value)
    ]);

    const blocoSeg = join([
      lineIf('Exposição solar/protetor', $('seg_solar').value),
      lineIf('Transporte', $('seg_transp').value),
      lineIf('Riscos domésticos', $('seg_dom').value),
      lineIf('EPIs', $('seg_epi').value),
      lineIf('Internet/conteúdo', $('seg_web').value)
    ]);

    const imcTxt = $('aux_imc').value? `${$('aux_imc').value} kg/m²` : '';
    const nutriTxt = $('aux_nutri').value;

    const blocoSint = join([
      lineIf('Crescimento/estado nutricional', $('sint_cresc').value),
      lineIf('IMC', imcTxt),
      lineIf('Status nutricional (indicativo)', nutriTxt),
      lineIf('Desempenho escolar e desenvolvimento', $('sint_dev').value),
      lineIf('Fatores de risco', $('sint_risco').value),
      lineIf('Condutas e orientações', $('sint_cond').value)
    ]);

    const blocoObs = $('obs_cuid').value || '—';

    const nota=
`1. Identificação
${blocoId}

2. Queixa principal (QP)
${blocoQP}

3. História da Moléstia Atual (HMA)
${blocoHMA}

4. Interrogatório sobre os diversos aparelhos (ISDA)
${blocoISDA}

5. Antecedentes pessoais
${blocoAnt}

6. Antecedentes familiares
${blocoFam}

7. História social e ambiental
${blocoSoc}

8. Hábitos e rotina
${blocoHab}

9. Desenvolvimento global
${blocoDev}

10. Escola e socialização
${blocoEscola}

11. Exposição e segurança
${blocoSeg}

12. Observações dos cuidadores
${blocoObs}

13. Síntese avaliativa e plano
${blocoSint}`;

    $('preview').textContent=nota.trim();
  }

  // inicializa
  update();
})();
</script>
</body>
</html>
